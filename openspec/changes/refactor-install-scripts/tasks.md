# 实施任务清单

## Phase 1: 修复 Linux 安装脚本

- [ ] **Task 1.1**: 重写目录检测逻辑
  - 优先当前目录（如果是 git 仓库）
  - 其次检查已存在的安装目录
  - 最后询问用户选择

- [ ] **Task 1.2**: 修复全局命令生成
  - 创建独立的 opencodecmd 脚本
  - 不依赖 install.sh 中的函数
  - 支持向上递归查找项目目录

- [ ] **Task 1.3**: 添加立即生效机制
  - 安装后自动 export PATH
  - 执行 hash -r 刷新命令表
  - 提示用户重启终端（如果需要）

- [ ] **Task 1.4**: 优化错误输出
  - 克隆失败时显示详细错误
  - 成功时静默所有输出
  - 使用 `$null = command` 而非 `2>&1 | Out-Null`

## Phase 2: 修复 Windows 安装脚本

- [ ] **Task 2.1**: 重写目录检测逻辑
  - 优先当前目录（如果是 git 仓库）
  - 其次检查已存在的安装目录
  - 最后询问用户选择

- [ ] **Task 2.2**: 修复全局命令生成
  - 创建 opencodecmd.bat 到 WindowsApps 目录
  - 创建 opencodecmd.ps1 到 bin 目录
  - 添加到用户 PATH 变量

- [ ] **Task 2.3**: 添加立即生效机制
  - 安装后添加到当前会话 $env:Path
  - 持久化到用户环境变量
  - 无需重启终端即可使用

- [ ] **Task 2.4**: 优化错误输出
  - 使用 `$null = command` 静默输出
  - 或使用 `*> $null` 完全静默
  - 保留真正的错误信息

## Phase 3: 创建独立全局命令脚本

- [ ] **Task 3.1**: 创建 install-global.sh
  - 独立于 install.sh
  - 可单独运行创建全局命令
  - 自动检测项目目录

- [ ] **Task 3.2**: 创建 install-global.ps1
  - Windows 版本的全局命令安装
  - 创建批处理和 PowerShell 脚本
  - 添加到 PATH

## Phase 4: 测试验证

- [ ] **Task 4.1**: Windows 测试
  - 在项目目录运行安装
  - 在非项目目录运行安装
  - 验证 opencodecmd 立即可用
  - 验证从任意位置都能运行

- [ ] **Task 4.2**: Linux 测试
  - 在项目目录运行安装
  - 在非项目目录运行安装
  - 验证 opencodecmd 立即可用
  - 验证从任意位置都能运行

- [ ] **Task 4.3**: 跨平台一致性检查
  - 确保两个平台体验一致
  - 错误提示清晰一致
  - 文档更新

## 完成标准

所有任务完成后：
1. 用户在任意目录运行安装，脚本安装到当前目录
2. 全局命令立即可用，无需手动操作
3. 无多余的错误输出干扰
4. Windows/Linux 体验一致
